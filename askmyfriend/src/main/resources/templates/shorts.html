<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Shorts - Daily Log</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    /* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ - ì‚¬ì´ë“œë°” + ë©”ì¸ */
    html, body {
      height: 100%; margin: 0; padding: 0;
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      transition: background 0.2s, color 0.2s;
    }
    body {
      display: flex; flex-direction: row;
      min-width: 1200px;
      transition: background 0.2s, color 0.2s;
    }

    /* ğŸ”¥ ì‚¬ìš©ì í”„ë¡œí•„ì´ í‘œì‹œë˜ëŠ” ì‚¬ì´ë“œë°” */
    .sidebar {
      width: 220px;
      background: #fff;
      border-right: 1px solid #eee;
      padding: 24px 0 0 0;
      box-sizing: border-box;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      height: 100vh;
      transition: background 0.2s, color 0.2s;
    }
    .sidebar .logo {
      font-weight: bold;
      margin-left: 24px;
      margin-bottom: 32px;
      font-size: 18px;
    }
    .sidebar .user {
      display: flex;
      align-items: center;
      margin-bottom: 32px;
      margin-left: 24px;
    }
    .sidebar .user img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 12px;
    }
    .sidebar .user .default-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(45deg, #667eea, #764ba2);
      margin-right: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0 0 4px 24px;
    }
    .sidebar ul li {
      margin-bottom: 20px;
      color: #333;
      font-size: 16px;
      cursor: pointer;
      transition: color 0.2s;
    }
    /* ì‚¬ì´ë“œë°” ë§í¬ ë°‘ì¤„ ì œê±° */
    .sidebar ul li a {
      color: inherit;
      text-decoration: none;
      transition: color 0.2s;
    }
    .sidebar ul li a:hover {
      color: #4f46e5;
    }
    /* ì„¤ì • ì•„ë˜ êµ¬ë¶„ì„  */
    .sidebar ul li:last-child {
      position: relative;
      padding-bottom: 4px;
    }
    .sidebar ul li:last-child::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      right: -5px;
      height: 1px;
      background: linear-gradient(to right, #e0e0e0 20%, #e0e0e0 80%, transparent);
    }
    /* ìƒˆ ê¸€ ì“°ê¸° ë²„íŠ¼ */
    .sidebar .new-post {
      display: block;
      margin-left: 24px;
      margin-bottom: 20px;
      padding: 0;
      background: none;
      color: #333;
      border: none;
      font-size: 16px;
      cursor: pointer;
      text-decoration: none;
      text-align: left;
      transition: color 0.2s;
    }
    .sidebar .new-post:hover {
      color: #4f46e5;
    }
    /* ë‹¤í¬ëª¨ë“œ í† ê¸€ */
    .toggle-theme {
      margin-left: 24px;
      margin-bottom: 20px;
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #888;
      padding: 0;
      transition: all 0.2s ease;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
    }
    .toggle-theme:hover {
      color: #333;
    }
    /* ë¡œê·¸ì•„ì›ƒ */
    .sidebar .logout {
      margin-left: 24px;
      color: #888;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 20px;
      transition: color 0.2s;
    }
    .sidebar .logout:hover {
      color: #4f46e5;
    }

    /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ - Shorts */
    .shorts-main {
      flex: 1;
      background: #f3f3f3;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      overflow: auto;
      padding-top: 40px;
      box-sizing: border-box;
      transition: background 0.2s, color 0.2s;
    }

    /* ë©”ì¸ ì»¨í…Œì´ë„ˆ - ì˜ìƒê³¼ ì»¨íŠ¸ë¡¤ì„ ë‚˜ë€íˆ ë°°ì¹˜ */
    .main-container {
      display: flex;
      align-items: flex-start;
      gap: 20px;
    }

    /* ë¹„ë””ì˜¤ ì»¨í…Œì´ë„ˆ */
    #shortsContainer {
      position: relative;
      width: 40vw;
      max-width: 360px;
      aspect-ratio: 9 / 16;
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    /* ë¹„ë””ì˜¤: í™”ë©´ ê½‰ ì±„ìš°ë˜ ë¹„ìœ¨ ìœ ì§€ */
    #shortsContainer video {
      width: 100%;
      height: 100%;
      object-fit: contain;
      background: #000;
    }

    /* ë‹¤ì‹œë³´ê¸° ë²„íŠ¼ */
    .reload {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 40px;
      height: 40px;
      background: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #333;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      z-index: 10;
    }

    /* ì‚¬ì´ë“œ ì»¨íŠ¸ë¡¤ - ì˜ìƒ ì˜†ì— ë°°ì¹˜ */
    .side-controls {
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding-top: 280px;
      align-items: center;
    }

    /* ì¢‹ì•„ìš” ë²„íŠ¼ - ìœ íŠœë¸Œ ì‡¼ì¸  ìŠ¤íƒ€ì¼ í•‘í¬ í•˜íŠ¸ */
    .like-button {
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: visible;
    }

    .like-button:before { 
      content: 'ğŸ¤'; 
      transition: all 0.3s ease;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
    }

    .like-button.liked {
      background: rgba(255, 255, 255, 0.95);
      animation: likeButtonPulse 0.6s ease;
      box-shadow: 0 4px 15px rgba(255, 20, 147, 0.3);
    }

    .like-button.liked:before { 
      content: 'ğŸ’–'; 
      transform: scale(1.1);
      filter: drop-shadow(0 2px 4px rgba(255, 20, 147, 0.4));
    }

    .like-button:hover { 
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    /* ì¢‹ì•„ìš” ë²„íŠ¼ í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes likeButtonPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    /* ë– ì˜¤ë¥´ëŠ” í•˜íŠ¸ ì• ë‹ˆë©”ì´ì…˜ */
    .floating-heart {
      position: absolute;
      font-size: 20px;
      pointer-events: none;
      animation: floatUp 2s ease-out forwards;
      z-index: 1000;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
    }

    @keyframes floatUp {
      0% {
        opacity: 1;
        transform: translateY(0) scale(1) rotate(0deg);
      }
      50% {
        opacity: 0.8;
        transform: translateY(-40px) scale(1.3) rotate(15deg);
      }
      100% {
        opacity: 0;
        transform: translateY(-80px) scale(0.8) rotate(30deg);
      }
    }

    /* ë°˜ì§ì´ëŠ” íš¨ê³¼ */
    .sparkle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: #ff1493;
      border-radius: 50%;
      pointer-events: none;
      animation: sparkleAnimation 1.2s ease-out forwards;
      box-shadow: 0 0 6px #ff1493;
    }

    @keyframes sparkleAnimation {
      0% {
        opacity: 1;
        transform: scale(0) rotate(0deg);
      }
      50% {
        opacity: 1;
        transform: scale(1.5) rotate(180deg);
      }
      100% {
        opacity: 0;
        transform: scale(0) rotate(360deg);
      }
    }

    /* ëŒ“ê¸€ ë²„íŠ¼ */
    .comment-button {
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      font-size: 24px;
      color: #666;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s ease;
    }
    .comment-button:before { 
      content: 'ğŸ’¬'; 
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
    }
    .comment-button:hover { transform: scale(1.1); }

    /* ê³µìœ  ë²„íŠ¼ */
    .share-button {
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s ease;
      font-size: 20px;
      color: #333;
    }
    .share-button:hover { transform: scale(1.1); }

    /* ì‹ ê³  ë²„íŠ¼ - ì‚¬ì´ë“œ ì»¨íŠ¸ë¡¤ì— ì¶”ê°€ */
    .report-button {
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      font-size: 18px;
      color: #666;
    }
    .report-button:hover { 
      transform: scale(1.1);
      color: #dc3545;
    }

    /* ë²„íŠ¼ ì•„ë˜ ìˆ«ì/í…ìŠ¤íŠ¸ */
    .side-controls span {
      font-size: 12px;
      color: #fff;
      text-align: center;
      display: block;
      margin-top: 4px;
      margin-bottom: 12px;
      font-weight: 600;
      text-shadow: 0 1px 2px rgba(0,0,0,0.7);
    }

    /* ì±„ë„ ì •ë³´ & ì„¤ëª… */
    .info {
      position: absolute;
      left: 16px;
      bottom: 16px;
      color: #fff;
      z-index: 10;
      max-width: 80%;
      line-height: 1.4;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
    }
    .info .channel {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    .info .channel img {
      width: 32px; height: 32px;
      border-radius: 50%;
      margin-right: 8px;
      object-fit: cover;
      border: 2px solid #fff;
    }
    .info .channel button {
      margin-left: auto;
      padding: 6px 12px;
      background: #ff1493;
      border: none;
      color: #fff;
      border-radius: 20px;
      font-size: 12px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s ease;
    }
    .info .channel button:hover {
      background: #e6127a;
    }
    
    /* ìˆ˜ì •ëœ ì„¤ëª… ì˜ì—­ - ë”ë³´ê¸°/ì ‘ê¸° ê¸°ëŠ¥ ì¶”ê°€ */
    .info .desc {
      font-size: 14px;
      opacity: 0.9;
      word-break: keep-all;
      max-height: 80px;
      overflow: hidden;
      line-height: 1.4;
      transition: max-height 0.3s ease;
      position: relative;
    }

    .info .desc.expanded {
      max-height: 200px;
      overflow-y: auto;
    }

    .info .desc-toggle {
      color: #ccc;
      font-size: 12px;
      cursor: pointer;
      margin-top: 4px;
      text-decoration: underline;
      display: inline-block;
    }

    .info .desc-toggle:hover {
      color: #fff;
    }

    /* êµ¬ë… ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #subscribeBtn {
      margin-left: 8px;
      padding: 6px 12px;
      background: #ff1493;
      color: #fff;
      border: none;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    #subscribeBtn.subscribed {
      background: #aaa;
    }
    #subscribeBtn:hover { 
      background: #e6127a; 
    }
    #subscribeBtn.subscribed:hover { 
      background: #888; 
    }

    /* ëŒ“ê¸€ ëª¨ë‹¬ - ìœ íŠœë¸Œ ì‡¼ì¸  ìŠ¤íƒ€ì¼ */
    #commentModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
    }

    .comment-panel {
      position: absolute;
      top: 10%;
      right: 0;
      width: 400px;
      height: 80%;
      background: white;
      border-radius: 12px 0 0 12px;
      display: flex;
      flex-direction: column;
      box-shadow: -4px 0 20px rgba(0,0,0,0.15);
    }

    .comment-header {
      padding: 16px 20px;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fafafa;
      border-radius: 12px 0 0 0;
    }

    .comment-header h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      color: #0f0f0f;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #606060;
      padding: 4px;
      border-radius: 4px;
    }

    .close-btn:hover {
      background: #f2f2f2;
    }

    .comments-list {
      flex: 1;
      overflow-y: auto;
      padding: 0;
    }

    .comment-item {
      padding: 12px 16px;
      display: flex;
      gap: 12px;
      align-items: flex-start;
      border-bottom: 1px solid #f0f0f0;
    }

    .comment-item:hover {
      background: #f9f9f9;
    }

    .comment-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
      flex-shrink: 0;
    }

    .comment-content {
      flex: 1;
      min-width: 0;
    }

    .comment-author {
      font-size: 13px;
      font-weight: 600;
      color: #0f0f0f;
      margin-bottom: 2px;
    }

    .comment-time {
      font-size: 12px;
      color: #606060;
      margin-left: 8px;
    }

    .comment-text {
      font-size: 14px;
      line-height: 1.4;
      color: #0f0f0f;
      margin: 4px 0 8px 0;
      word-wrap: break-word;
    }

    .comment-actions {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-top: 4px;
    }

    /* ëŒ“ê¸€ ì¢‹ì•„ìš” ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .comment-like-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 12px;
      color: #606060;
      padding: 6px 8px;
      border-radius: 6px;
      transition: all 0.2s ease;
    }

    .comment-like-btn:hover {
      background: #f2f2f2;
      transform: scale(1.05);
    }

    .comment-like-btn.liked {
      color: #ff1493;
    }

    .comment-like-btn .like-count {
      font-weight: 600;
      min-width: 16px;
      text-align: left;
    }

    .comment-reply-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 12px;
      color: #606060;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 4px;
    }

    .comment-reply-btn:hover {
      background: #f2f2f2;
    }

    .comment-input-section {
      padding: 12px 16px;
      border-top: 1px solid #e0e0e0;
      background: #fafafa;
      border-radius: 0 0 0 12px;
    }

    .comment-input-wrapper {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .current-user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
    }

    .input-container {
      flex: 1;
      display: flex;
      align-items: center;
      background: white;
      border-radius: 20px;
      padding: 8px 16px;
      border: 1px solid #e0e0e0;
    }

    .comment-input {
      flex: 1;
      border: none;
      outline: none;
      font-size: 14px;
      background: transparent;
    }

    .submit-btn {
      background: none;
      border: none;
      color: #ff1493;
      font-weight: 600;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
    }

    .submit-btn:hover {
      background: #fff0f8;
    }

    .submit-btn:disabled {
      color: #ccc;
      cursor: not-allowed;
    }

    .empty-comments {
      text-align: center;
      padding: 40px 20px;
      color: #606060;
    }

    /* ì‹ ê³  ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .report-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      overflow-y: auto;
    }
    .report-modal.show {
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 20px;
      box-sizing: border-box;
    }
    .report-modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 30px;
      border-radius: 16px;
      width: 90%;
      max-width: 450px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      position: relative;
    }
    body.dark .report-modal-content {
      background-color: #2a2d31;
      color: #e6e6e6;
    }
    .report-modal h3 {
      margin-top: 0;
      color: #dc3545;
      font-size: 1.3rem;
      margin-bottom: 20px;
    }
    .report-reasons {
      margin: 20px 0;
    }
    .report-reason {
      display: block;
      margin: 12px 0;
      cursor: pointer;
      padding: 12px;
      border-radius: 8px;
      transition: background 0.2s;
      border: 1px solid #e9ecef;
    }
    .report-reason:hover {
      background: #f8f9fa;
      border-color: #dc3545;
    }
    body.dark .report-reason {
      border-color: #404040;
    }
    body.dark .report-reason:hover {
      background: #404040;
      border-color: #dc3545;
    }
    .report-reason input {
      margin-right: 10px;
    }
    .report-buttons {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 30px;
    }
    .report-submit-btn, .report-cancel-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      font-weight: 500;
    }
    .report-submit-btn {
      background: #dc3545;
      color: white;
    }
    .report-submit-btn:hover {
      background: #c82333;
    }
    .report-cancel-btn {
      background: #6c757d;
      color: white;
    }
    .report-cancel-btn:hover {
      background: #545b62;
    }

    /* ë‹¤í¬ëª¨ë“œ ìŠ¤íƒ€ì¼ */
    body.dark {
      background: #181a1b !important;
      color: #e6e6e6 !important;
    }
    body.dark .sidebar {
      background: #1a1c1e;
      border-right: 1px solid #222;
    }
    body.dark .shorts-main {
      background: #181a1b;
    }
    body.dark .sidebar ul li,
    body.dark .sidebar .logo,
    body.dark .sidebar .logout,
    body.dark .sidebar .new-post {
      color: #e6e6e6;
    }
    /* ë‹¤í¬ëª¨ë“œ ë§í¬ ë°‘ì¤„ ì œê±° */
    body.dark .sidebar ul li a {
      color: inherit;
      text-decoration: none;
    }
    body.dark .sidebar ul li a:hover {
      color: #6366f1;
    }
    body.dark .sidebar .new-post:hover {
      color: #6366f1;
    }
    body.dark .sidebar .logout:hover {
      color: #6366f1;
    }
    body.dark .sidebar ul li:last-child::after {
      background: linear-gradient(to right, #404040 20%, #404040 80%, transparent);
    }
    body.dark .toggle-theme {
      color: #e6e6e6;
    }
    body.dark .toggle-theme:hover {
      color: #fff;
    }

    /* ë°˜ì‘í˜• - ëª¨ë°”ì¼ì—ì„œëŠ” ê¸°ì¡´ ë ˆì´ì•„ì›ƒ ìœ ì§€ */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
        min-width: auto;
      }
      
      .sidebar {
        width: 100%;
        height: auto;
        min-height: auto;
        padding: 20px 0;
      }
      
      .shorts-main {
        padding-top: 20px;
      }
      
      .main-container {
        flex-direction: column;
        align-items: center;
      }
      
      .side-controls {
        flex-direction: row;
        padding-top: 20px;
        gap: 20px;
      }
      
      .side-controls span {
        margin-bottom: 0;
      }

      .comment-panel {
        width: 100%;
        top: 40%;
        height: 60%;
        border-radius: 12px 12px 0 0;
      }
      
      .report-modal-content { 
        margin: 2% auto;
        padding: 20px; 
        width: 95%;
        max-width: 400px;
      }
    }
  </style>
</head>
<body>

  <!-- ğŸ”¥ ì‚¬ìš©ì í”„ë¡œí•„ì´ í‘œì‹œë˜ëŠ” ì‚¬ì´ë“œë°” -->
  <div class="sidebar">
    <div class="logo">Daily Log</div>
    <div class="user">
      <img th:if="${user != null and user.profileImg != null}" 
           th:src="@{${user.profileImg}}" 
           alt="User" />
      <div th:if="${user == null or user.profileImg == null}" 
           class="default-avatar">
        <span th:text="${user != null ? user.nickname.substring(0,1).toUpperCase() : '?'}">?</span>
      </div>
      <div>
        <div th:text="${user != null ? user.nickname : 'ì‚¬ìš©ìëª…'}">ì‚¬ìš©ìëª…</div>
      </div>
    </div>
    <ul>
      <li><a th:href="@{/}">í™ˆ</a></li>
      <li><a th:href="@{/posts}">ê¸€ ëª©ë¡</a></li>
      <li><a th:href="@{/notifications}">ì•Œë¦¼</a></li>
      <li><a th:href="@{/friends}">ì¹œêµ¬ ëª©ë¡</a></li>
      <li><a th:href="@{/chat}">ì±„íŒ…</a></li>
      <li><a th:href="@{/shorts}">ìˆí¼</a></li>
      <li><a th:href="@{/subscriptions}">êµ¬ë… ê´€ë¦¬</a></li>
      <li><a th:href="@{/mypage}">ë‚´ í”„ë¡œí•„</a></li>
      <li><a th:href="@{/setting}">ì„¤ì •</a></li>
    </ul>
    <a th:href="@{/posts/new}" class="new-post">ìƒˆ ê¸€ ì“°ê¸°</a>
    <div class="logout" onclick="location.href='/logout'">ë¡œê·¸ì•„ì›ƒ</div>
    <button class="toggle-theme" onclick="toggleTheme()">ğŸŒ™</button>
  </div>

  <!-- ë©”ì¸ ì»¨í…ì¸  - Shorts -->
  <div class="shorts-main">
    <div class="main-container">
      <div id="shortsContainer">
        <video id="shortVideo" autoplay muted playsinline></video>

        <div class="reload" onclick="loadNext()">
          <i class="fa-solid fa-arrows-rotate"></i>
        </div>

        <div class="info">
          <div class="channel">
            <img id="channelAvatar" src="/static/img/default-avatar.png" alt="í”„ë¡œí•„">
            <strong id="channelName">@ì‘ì„±ì</strong>
            <button id="subscribeBtn" data-author-id="">êµ¬ë…</button>
          </div>
          <div class="desc" id="videoDesc">
            ì˜ìƒ ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
          </div>
        </div>
      </div>

      <div class="side-controls">
        <div>
          <button class="like-button" onclick="toggleLike(this)"></button>
          <span id="likeCount">1</span>
        </div>

        <div>
          <button class="comment-button" onclick="openComments()"></button>
          <span id="commentCount">2</span>
        </div>

        <div>
          <button class="share-button" onclick="share()">
            <i class="fa-solid fa-share"></i>
          </button>
          <span>ê³µìœ </span>
        </div>

        <!-- ì‹ ê³  ë²„íŠ¼ ì¶”ê°€ -->
        <div>
          <button class="report-button" onclick="openReportModal()">
            <i class="fas fa-flag"></i>
          </button>
          <span>ì‹ ê³ </span>
        </div>
      </div>
    </div>
  </div>

  <!-- ëŒ“ê¸€ ëª¨ë‹¬ - ìœ íŠœë¸Œ ì‡¼ì¸  ìŠ¤íƒ€ì¼ -->
  <div id="commentModal">
    <div class="comment-panel">
      <!-- í—¤ë” -->
      <div class="comment-header">
        <h3>ëŒ“ê¸€ <span id="commentCountHeader">0</span></h3>
        <button class="close-btn" onclick="closeComments()">&times;</button>
      </div>
      
      <!-- ëŒ“ê¸€ ëª©ë¡ -->
      <div id="commentsList" class="comments-list">
        <!-- ëŒ“ê¸€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
      </div>
      
      <!-- ëŒ“ê¸€ ì…ë ¥ì°½ -->
      <div class="comment-input-section">
        <div class="comment-input-wrapper">
          <img id="currentUserAvatar" src="/static/img/default-avatar.png" 
               class="current-user-avatar" alt="ë‚´ í”„ë¡œí•„">
          <div class="input-container">
            <input type="text" id="commentInput" class="comment-input" 
                   placeholder="ëŒ“ê¸€ ì¶”ê°€...">
            <button class="submit-btn" onclick="submitComment()">ì „ì†¡</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì‹ ê³  ëª¨ë‹¬ -->
  <div id="reportModal" class="report-modal">
    <div class="report-modal-content">
      <h3><i class="fas fa-flag"></i> ì˜ìƒ ì‹ ê³ í•˜ê¸°</h3>
      <p>ì´ ì˜ìƒì„ ì‹ ê³ í•˜ëŠ” ì´ìœ ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
      
      <div class="report-reasons">
        <label class="report-reason">
          <input type="radio" name="reportReason" value="spam">
          <span>ìŠ¤íŒ¸ ë˜ëŠ” ê´‘ê³ </span>
        </label>
        <label class="report-reason">
          <input type="radio" name="reportReason" value="harassment">
          <span>ê´´ë¡­í˜ ë˜ëŠ” í˜ì˜¤ ë°œì–¸</span>
        </label>
        <label class="report-reason">
          <input type="radio" name="reportReason" value="inappropriate">
          <span>ë¶€ì ì ˆí•œ ì½˜í…ì¸ </span>
        </label>
        <label class="report-reason">
          <input type="radio" name="reportReason" value="copyright">
          <span>ì €ì‘ê¶Œ ì¹¨í•´</span>
        </label>
        <label class="report-reason">
          <input type="radio" name="reportReason" value="false_info">
          <span>ê±°ì§“ ì •ë³´</span>
        </label>
        <label class="report-reason">
          <input type="radio" name="reportReason" value="other">
          <span>ê¸°íƒ€</span>
        </label>
      </div>
      
      <div class="report-buttons">
        <button class="report-cancel-btn" onclick="closeReportModal()">ì·¨ì†Œ</button>
        <button class="report-submit-btn" onclick="submitReport()">ì‹ ê³ í•˜ê¸°</button>
      </div>
    </div>
  </div>

  <script>
    let currentPostId = null;
    let currentUserEmail = null;
    let currentPost = null;

    // ë‹¤í¬ëª¨ë“œ í† ê¸€
    function toggleTheme() {
      document.body.classList.toggle('dark');
      const theme = document.body.classList.contains('dark') ? 'dark' : 'light';
      localStorage.setItem('theme', theme);
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë‹¤í¬ëª¨ë“œ ë³µì›
    window.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('theme');
      if (saved === 'dark') {
        document.body.classList.add('dark');
      }
      initializePage();
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ì´ë©”ì¼ ê°€ì ¸ì˜¤ê¸°
    async function getCurrentUser() {
        try {
            const response = await fetch('/api/current-user');
            const user = await response.json();
            currentUserEmail = user.email;
            
            // í˜„ì¬ ì‚¬ìš©ì ì•„ë°”íƒ€ ì„¤ì •
            if (user.profileImg) {
                document.getElementById('currentUserAvatar').src = user.profileImg;
            }
        } catch (error) {
            console.error('ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', error);
        }
    }

    // í…ìŠ¤íŠ¸ ê¸¸ì´ì— ë”°ë¼ ë”ë³´ê¸° ë²„íŠ¼ í‘œì‹œ
    function setupDescriptionToggle(content) {
        const descElement = document.getElementById('videoDesc');
        const maxLength = 100; // 100ì ì´ìƒì´ë©´ ë”ë³´ê¸° í‘œì‹œ
        
        if (content && content.length > maxLength) {
            const shortText = content.substring(0, maxLength) + '...';
            descElement.innerHTML = `
                <span class="desc-text">${shortText}</span>
                <br><span class="desc-toggle" onclick="toggleDescription()">ë”ë³´ê¸°</span>
            `;
            descElement.setAttribute('data-full-text', content);
            descElement.setAttribute('data-short-text', shortText);
        } else {
            descElement.innerText = content || 'ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.';
        }
    }

    // ë”ë³´ê¸°/ì ‘ê¸° í† ê¸€ í•¨ìˆ˜
    function toggleDescription() {
        const descElement = document.getElementById('videoDesc');
        const fullText = descElement.getAttribute('data-full-text');
        const shortText = descElement.getAttribute('data-short-text');
        const isExpanded = descElement.classList.contains('expanded');
        
        if (isExpanded) {
            // ì ‘ê¸°
            descElement.innerHTML = `
                <span class="desc-text">${shortText}</span>
                <br><span class="desc-toggle" onclick="toggleDescription()">ë”ë³´ê¸°</span>
            `;
            descElement.classList.remove('expanded');
        } else {
            // í¼ì¹˜ê¸°
            descElement.innerHTML = `
                <span class="desc-text">${fullText}</span>
                <br><span class="desc-toggle" onclick="toggleDescription()">ì ‘ê¸°</span>
            `;
            descElement.classList.add('expanded');
        }
    }

    // ìˆ˜ì •ëœ loadNext í•¨ìˆ˜ - ì‹¤ì‹œê°„ êµ¬ë… ìƒíƒœ í™•ì¸
    async function loadNext() {
        try {
            const res = await fetch('/shorts/random');
            const post = await res.json();
            if (!post.videoPath) return;

            currentPost = post;
            currentPostId = post.id;

            const v = document.getElementById('shortVideo');
            document.getElementById('likeCount').innerText = formatCount(post.likeCount || 0);
            document.getElementById('commentCount').innerText = formatCount(post.commentCount || 0);
            
            setupDescriptionToggle(post.content);
            
            document.getElementById('channelName').innerText = post.authorNickname || '@ì‘ì„±ì';
            document.getElementById('channelAvatar').src = post.authorProfileImg || '/static/img/default-avatar.png';
            
            const subscribeBtn = document.getElementById('subscribeBtn');
            subscribeBtn.setAttribute('data-author-id', post.authorId || '');
            
            // ìê¸° ìì‹ ì˜ ê²Œì‹œë¬¼ì¸ì§€ í™•ì¸
            const isMyPost = await checkIfMyPost(post.authorId);
            
            if (isMyPost) {
                // ìê¸° ìì‹ ì˜ ê²Œì‹œë¬¼ì´ë©´ êµ¬ë… ë²„íŠ¼ ìˆ¨ê¸°ê¸°
                subscribeBtn.style.display = 'none';
            } else {
                // ë‹¤ë¥¸ ì‚¬ëŒì˜ ê²Œì‹œë¬¼ì´ë©´ êµ¬ë… ë²„íŠ¼ í‘œì‹œ
                subscribeBtn.style.display = 'inline-block';
                // ì‹¤ì‹œê°„ êµ¬ë… ìƒíƒœ í™•ì¸
                await updateSubscribeButtonRealtime(post.authorId);
            }
            
            v.src = post.videoPath;
            await v.play();
            
            await checkLikeStatus();
            
        } catch (error) {
            console.error('ì˜ìƒ ë¡œë“œ ì‹¤íŒ¨:', error);
        }
    }

    // ìê¸° ìì‹ ì˜ ê²Œì‹œë¬¼ì¸ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
    async function checkIfMyPost(authorId) {
        if (!currentUserEmail || !authorId) {
            return false;
        }
        
        try {
            const myUserResponse = await fetch('/api/my-user-id');
            const myUserId = await myUserResponse.json();
            
            return myUserId === authorId;
            
        } catch (error) {
            console.error('ì‚¬ìš©ì í™•ì¸ ì‹¤íŒ¨:', error);
            return false;
        }
    }

    // ì‹¤ì‹œê°„ êµ¬ë… ìƒíƒœ í™•ì¸ í•¨ìˆ˜
    async function updateSubscribeButtonRealtime(authorId) {
        const btn = document.getElementById('subscribeBtn');
        
        if (!authorId || !currentUserEmail) {
            btn.innerText = 'êµ¬ë…';
            btn.classList.remove('subscribed');
            return;
        }
        
        try {
            // êµ¬ë… ê´€ë¦¬ì™€ ë™ì¼í•œ API ì‚¬ìš©
            const res = await fetch(`/subscriptions/${authorId}/status`);
            const result = await res.json();
            
            const isSubscribed = result.subscribed;
            
            btn.classList.toggle('subscribed', isSubscribed);
            btn.innerText = isSubscribed ? 'êµ¬ë…ì¤‘' : 'êµ¬ë…';
            
            // currentPost ê°ì²´ë„ ì—…ë°ì´íŠ¸
            if (currentPost) {
                currentPost.subscribed = isSubscribed;
            }
            
        } catch (e) { 
            console.error('êµ¬ë… ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', e);
            btn.innerText = 'êµ¬ë…';
            btn.classList.remove('subscribed');
        }
    }

    // ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸ í•¨ìˆ˜
    async function checkLikeStatus() {
        if (!currentPostId || !currentUserEmail) {
            const likeBtn = document.querySelector('.like-button');
            likeBtn.classList.remove('liked');
            return;
        }
        
        try {
            const response = await fetch(`/likes/status/${currentPostId}?userEmail=${encodeURIComponent(currentUserEmail)}`);
            const isLiked = await response.json();
            
            const likeBtn = document.querySelector('.like-button');
            
            if (isLiked) {
                likeBtn.classList.add('liked');
            } else {
                likeBtn.classList.remove('liked');
            }
            
        } catch (error) {
            console.error('ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
            const likeBtn = document.querySelector('.like-button');
            likeBtn.classList.remove('liked');
        }
    }

    // ì¢‹ì•„ìš” í† ê¸€ í•¨ìˆ˜
    async function toggleLike(btn) {
        if (!currentPostId || !currentUserEmail) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            return;
        }

        const wasLiked = btn.classList.contains('liked');

        try {
            const response = await fetch(`/likes/${currentPostId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `userEmail=${encodeURIComponent(currentUserEmail)}`
            });

            if (response.ok) {
                const newLikeCount = await response.json();
                
                await checkLikeStatus();
                
                document.getElementById('likeCount').innerText = formatCount(newLikeCount);
                
                if (!wasLiked && btn.classList.contains('liked')) {
                    createFloatingHearts(btn);
                    createSparkles(btn);
                    
                    btn.style.animation = 'likeButtonPulse 0.6s ease';
                    
                    setTimeout(() => {
                        btn.style.animation = '';
                    }, 600);
                } else if (wasLiked && !btn.classList.contains('liked')) {
                    btn.style.transform = 'scale(0.9)';
                    setTimeout(() => {
                        btn.style.transform = 'scale(1)';
                    }, 150);
                }
                
            } else {
                throw new Error('ì¢‹ì•„ìš” ì²˜ë¦¬ ì‹¤íŒ¨');
            }
        } catch (error) {
            console.error('ì¢‹ì•„ìš” í† ê¸€ ì‹¤íŒ¨:', error);
            alert('ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // ë– ì˜¤ë¥´ëŠ” í•˜íŠ¸ ìƒì„±
    function createFloatingHearts(button) {
        const hearts = ['ğŸ’–', 'ğŸ’•', 'ğŸ’—', 'ğŸ’“', 'ğŸ’'];
        
        for (let i = 0; i < 6; i++) {
            setTimeout(() => {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                
                const rect = button.getBoundingClientRect();
                heart.style.left = (rect.left + Math.random() * 60 - 30) + 'px';
                heart.style.top = rect.top + 'px';
                
                document.body.appendChild(heart);
                
                setTimeout(() => {
                    if (heart.parentNode) {
                        heart.parentNode.removeChild(heart);
                    }
                }, 2000);
            }, i * 80);
        }
    }

    // ë°˜ì§ì´ëŠ” íš¨ê³¼ ìƒì„±
    function createSparkles(button) {
        const colors = ['#ff1493', '#ff69b4', '#ffc0cb', '#ff91a4', '#ffb6c1'];
        
        for (let i = 0; i < 10; i++) {
            setTimeout(() => {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                const rect = button.getBoundingClientRect();
                const angle = (i / 10) * 2 * Math.PI;
                const radius = 35 + Math.random() * 25;
                
                sparkle.style.left = (rect.left + rect.width/2 + Math.cos(angle) * radius) + 'px';
                sparkle.style.top = (rect.top + rect.height/2 + Math.sin(angle) * radius) + 'px';
                
                document.body.appendChild(sparkle);
                
                setTimeout(() => {
                    if (sparkle.parentNode) {
                        sparkle.parentNode.removeChild(sparkle);
                    }
                }, 1200);
            }, i * 40);
        }
    }

    // ëŒ“ê¸€ ì°½ ì—´ê¸°
    async function openComments() {
        if (!currentPostId) {
            alert('ì˜ìƒì„ ë¨¼ì € ë¡œë“œí•´ì£¼ì„¸ìš”.');
            return;
        }
        
        try {
            const response = await fetch(`/api/comments/${currentPostId}`);
            const comments = await response.json();
            
            document.getElementById('commentCountHeader').textContent = comments.length;
            
            const commentsList = document.getElementById('commentsList');
            commentsList.innerHTML = '';
            
            if (comments.length === 0) {
                commentsList.innerHTML = `
                    <div class="empty-comments">
                        <p style="margin: 0; font-size: 14px;">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p style="margin: 8px 0 0 0; font-size: 13px;">ì²« ë²ˆì§¸ ëŒ“ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                    </div>
                `;
            } else {
                for (const comment of comments) {
                    const likeStatusResponse = await fetch(`/api/comments/${comment.id}/like-status`);
                    const likeStatus = await likeStatusResponse.json();
                    
                    const commentDiv = document.createElement('div');
                    commentDiv.className = 'comment-item';
                    commentDiv.innerHTML = `
                        <img src="${comment.authorProfileImg || '/static/img/default-avatar.png'}" 
                             alt="í”„ë¡œí•„" class="comment-avatar"
                             onerror="this.src='/static/img/default-avatar.png'">
                        <div class="comment-content">
                            <div style="display: flex; align-items: center;">
                                <span class="comment-author">${comment.author}</span>
                                <span class="comment-time">${formatTimeAgo(comment.createdAt)}</span>
                            </div>
                            <p class="comment-text">${comment.content}</p>
                            <div class="comment-actions">
                                <button class="comment-like-btn ${likeStatus.liked ? 'liked' : ''}" 
                                        onclick="toggleCommentLike(${comment.id}, this)">
                                    <span>${likeStatus.liked ? 'ğŸ’–' : 'ğŸ¤'}</span>
                                    <span class="like-count">${likeStatus.likeCount || 0}</span>
                                </button>
                                <button class="comment-reply-btn" onclick="replyComment(${comment.id})">
                                    ë‹µê¸€
                                </button>
                            </div>
                        </div>
                    `;
                    commentsList.appendChild(commentDiv);
                }
            }
            
            document.getElementById('commentModal').style.display = 'block';
            document.getElementById('commentInput').focus();
            
        } catch (error) {
            console.error('ëŒ“ê¸€ ë¡œë“œ ì‹¤íŒ¨:', error);
            alert('ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
    }

    // ëŒ“ê¸€ ì¢‹ì•„ìš” í† ê¸€ í•¨ìˆ˜
    async function toggleCommentLike(commentId, button) {
        try {
            const response = await fetch(`/api/comments/${commentId}/like`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            
            const result = await response.json();
            
            if (result.success) {
                const heartSpan = button.querySelector('span:first-child');
                const countSpan = button.querySelector('.like-count');
                
                if (result.liked) {
                    button.classList.add('liked');
                    heartSpan.textContent = 'ğŸ’–';
                    
                    button.style.transform = 'scale(1.2)';
                    setTimeout(() => {
                        button.style.transform = 'scale(1)';
                    }, 200);
                } else {
                    button.classList.remove('liked');
                    heartSpan.textContent = 'ğŸ¤';
                }
                
                countSpan.textContent = result.likeCount || 0;
                
            } else {
                alert(result.message || 'ì¢‹ì•„ìš” ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
            
        } catch (error) {
            console.error('ëŒ“ê¸€ ì¢‹ì•„ìš” ì‹¤íŒ¨:', error);
            alert('ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // ëŒ“ê¸€ ì‘ì„±
    async function submitComment() {
        const commentInput = document.getElementById('commentInput');
        const content = commentInput.value.trim();
        
        if (!content) {
            alert('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }
        
        if (!currentPostId) {
            alert('ì˜ìƒì„ ë¨¼ì € ë¡œë“œí•´ì£¼ì„¸ìš”.');
            return;
        }
        
        try {
            const response = await fetch(`/api/comments/${currentPostId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `content=${encodeURIComponent(content)}`
            });
            
            const result = await response.json();
            
            if (result.success) {
                document.getElementById('commentCount').innerText = formatCount(result.commentCount);
                
                commentInput.value = '';
                
                openComments();
                
            } else {
                alert(result.message || 'ëŒ“ê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
            
        } catch (error) {
            console.error('ëŒ“ê¸€ ì‘ì„± ì‹¤íŒ¨:', error);
            alert('ëŒ“ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // ëŒ“ê¸€ ì°½ ë‹«ê¸°
    function closeComments() {
        document.getElementById('commentModal').style.display = 'none';
    }

    // ì‹œê°„ í¬ë§·íŒ…
    function formatTimeAgo(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diff = now - date;
        
        const minutes = Math.floor(diff / (1000 * 60));
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const weeks = Math.floor(days / 7);
        const months = Math.floor(days / 30);
        const years = Math.floor(days / 365);
        
        if (minutes < 1) return 'ë°©ê¸ˆ ì „';
        if (minutes < 60) return `${minutes}ë¶„ ì „`;
        if (hours < 24) return `${hours}ì‹œê°„ ì „`;
        if (days < 7) return `${days}ì¼ ì „`;
        if (weeks < 4) return `${weeks}ì£¼ ì „`;
        if (months < 12) return `${months}ê°œì›” ì „`;
        return `${years}ë…„ ì „`;
    }

    // ëŒ“ê¸€ ë‹µê¸€ (ì¶”í›„ êµ¬í˜„)
    function replyComment(commentId) {
        console.log('ëŒ“ê¸€ ë‹µê¸€:', commentId);
    }
    
    function share() {
        if (navigator.share) {
            navigator.share({
                title: 'Shorts ì˜ìƒ',
                text: 'ì¬ë¯¸ìˆëŠ” ì˜ìƒì„ í™•ì¸í•´ë³´ì„¸ìš”!',
                url: window.location.href
            });
        } else {
            navigator.clipboard.writeText(window.location.href)
                .then(() => alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'))
                .catch(() => alert('ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'));
        }
    }
    
    // ìˆ«ì í¬ë§·íŒ…
    function formatCount(count) {
        if (count >= 1000000) {
            return (count / 1000000).toFixed(1) + 'M';
        } else if (count >= 1000) {
            return (count / 1000).toFixed(1) + 'K';
        }
        return count.toString();
    }

    // ìˆ˜ì •ëœ êµ¬ë…/êµ¬ë…ì·¨ì†Œ í† ê¸€ í•¨ìˆ˜ - êµ¬ë… ê´€ë¦¬ì™€ ë™ì¼í•œ API ì‚¬ìš©
    async function toggleSubscribe() {
        const btn = document.getElementById('subscribeBtn');
        const authorId = btn.dataset.authorId;
        
        if (!authorId) {
            alert('ì‘ì„±ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        
        if (!currentUserEmail) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            return;
        }
        
        const isCurrentlySubscribed = btn.classList.contains('subscribed');
        const endpoint = isCurrentlySubscribed ? 'unsubscribe' : 'subscribe';
        
        try {
            // êµ¬ë… ê´€ë¦¬ì™€ ë™ì¼í•œ URL ì‚¬ìš©
            const res = await fetch(`/subscriptions/${authorId}/${endpoint}`, { 
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            const result = await res.json();
            
            if (result.success) {
                btn.classList.toggle('subscribed');
                btn.innerText = isCurrentlySubscribed ? 'êµ¬ë…' : 'êµ¬ë…ì¤‘';
                
                if (currentPost) {
                    currentPost.subscribed = !isCurrentlySubscribed;
                }
            } else {
                alert(result.error || 'êµ¬ë… ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
            
        } catch (e) {
            console.error('êµ¬ë… ì²˜ë¦¬ ì‹¤íŒ¨:', e);
            alert('êµ¬ë… ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // ì‹ ê³  ëª¨ë‹¬ ì—´ê¸°
    function openReportModal() {
        if (!currentPostId) {
            alert('ì˜ìƒì„ ë¨¼ì € ë¡œë“œí•´ì£¼ì„¸ìš”.');
            return;
        }
        
        const modal = document.getElementById('reportModal');
        modal.style.display = 'flex';
        modal.classList.add('show');
        
        // body ìŠ¤í¬ë¡¤ ë°©ì§€
        document.body.style.overflow = 'hidden';
        
        // ë¼ë””ì˜¤ ë²„íŠ¼ ì´ˆê¸°í™”
        document.querySelectorAll('input[name="reportReason"]').forEach(radio => {
            radio.checked = false;
        });
    }

    // ì‹ ê³  ëª¨ë‹¬ ë‹«ê¸°
    function closeReportModal() {
        const modal = document.getElementById('reportModal');
        modal.style.display = 'none';
        modal.classList.remove('show');
        
        // body ìŠ¤í¬ë¡¤ ë³µì›
        document.body.style.overflow = 'auto';
    }

    // ì‹ ê³  ì œì¶œ
    function submitReport() {
        const selectedReason = document.querySelector('input[name="reportReason"]:checked');
        if (!selectedReason) {
            alert('ì‹ ê³  ì‚¬ìœ ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }
        
        if (!currentPostId) {
            alert('ì˜ìƒì„ ë¨¼ì € ë¡œë“œí•´ì£¼ì„¸ìš”.');
            return;
        }
        
        const reportData = {
            postId: currentPostId,
            author: currentPost ? currentPost.authorNickname : 'ì•Œ ìˆ˜ ì—†ìŒ',
            reason: selectedReason.value
        };
        
        // ì„œë²„ë¡œ ì‹ ê³  ë°ì´í„° ì „ì†¡
        fetch('/reports', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(reportData)
        })
        .then(response => {
            if (response.ok) {
                alert('ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ê²€í†  í›„ ì ì ˆí•œ ì¡°ì¹˜ë¥¼ ì·¨í•˜ê² ìŠµë‹ˆë‹¤.');
                closeReportModal();
            } else {
                alert('ì‹ ê³  ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('ì‹ ê³  ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        });
    }

    // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeComments();
            closeReportModal();
        }
    });

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
        const reportModal = document.getElementById('reportModal');
        if (event.target === reportModal) {
            closeReportModal();
        }
    }

    // ì—”í„° í‚¤ë¡œ ëŒ“ê¸€ ì „ì†¡
    document.addEventListener('DOMContentLoaded', function() {
        const commentInput = document.getElementById('commentInput');
        if (commentInput) {
            commentInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    submitComment();
                }
            });
        }
    });

    // êµ¬ë… ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('subscribeBtn').addEventListener('click', toggleSubscribe);
        document.getElementById('shortVideo').addEventListener('ended', loadNext);
    });

    // ì´ˆê¸°í™” í•¨ìˆ˜
    async function initializePage() {
        await getCurrentUser();
        await loadNext();
    }
  </script>
</body>
</html>